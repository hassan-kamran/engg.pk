# engg.pk - Project Instructions for Claude

## Project Overview

This is **engg.pk**, a Django-based engineering community platform for Pakistani engineers. The platform provides forums, university reviews, career guidance, job boards, scholarships, and startup resources.

## Technology Stack

- **Backend**: Django 5.x with PostgreSQL/SQLite
- **Frontend**: Django Templates + HTMX + Tailwind CSS + Alpine.js
- **Deployment**: Gunicorn + WhiteNoise
- **Architecture**: Server-side rendering (SSR) for optimal SEO

## Critical: Python Package Manager

**ALWAYS use `uv` for Python package management.** Never use `pip`, `pip3`, `poetry`, or other package managers.

### Package Management Commands

```bash
# Install dependencies
uv pip install -r requirements.txt

# Add a new package
uv pip install <package-name>

# Freeze dependencies
uv pip freeze > requirements.txt

# Upgrade a package
uv pip install --upgrade <package-name>

# Install in development mode
uv pip install -e .
```

## Django Project Structure

```
engg.pk/
├── config/              # Django project settings
│   ├── settings.py      # Main settings file
│   ├── urls.py          # Root URL configuration
│   └── wsgi.py          # WSGI application
├── core/                # Core app (homepage, about, subjects)
├── forum/               # Community forum
├── universities/        # University program reviews
├── careers/             # Career paths and guidance
├── jobs/                # Job board
├── scholarships/        # Scholarship database
├── insights/            # Industry insights
├── startups/            # Startup resources
├── templates/           # Django templates (server-side rendering)
├── static/              # Static files (CSS, JS, images)
├── manage.py            # Django management script
└── requirements.txt     # Python dependencies
```

## Development Workflow

### Setting Up Development Environment

1. **Never create a virtualenv manually** - `uv` handles this automatically
2. **Always use `uv pip install`** for any package installations
3. **Check for `.env` file** - copy from `.env.example` if missing
4. **Run migrations** before starting development
5. **Create superuser** if working with admin panel

### Common Django Commands

```bash
# Run development server
python manage.py runserver

# Create migrations
python manage.py makemigrations

# Apply migrations
python manage.py migrate

# Create superuser
python manage.py createsuperuser

# Open Django shell
python manage.py shell

# Collect static files (production)
python manage.py collectstatic

# Run tests
python manage.py test

# Load sample data (if fixtures exist)
python manage.py loaddata <fixture_name>
```

## Code Guidelines

### Django Best Practices

1. **Models**:
   - Use descriptive field names
   - Add `__str__` methods to all models
   - Use proper field types (CharField, TextField, ForeignKey, etc.)
   - Add `Meta` class with `ordering` and `verbose_name_plural`
   - Create indexes for frequently queried fields

2. **Views**:
   - Prefer class-based views (CBVs) for CRUD operations
   - Use function-based views (FBVs) for simple logic
   - Always use `get_object_or_404()` for single object retrieval
   - Implement proper permission checks
   - Keep views thin, move logic to models/managers

3. **Templates**:
   - Extend from `base.html`
   - Use template inheritance properly
   - Keep logic minimal in templates
   - Use HTMX attributes for dynamic interactions
   - Follow Tailwind CSS utility classes

4. **URLs**:
   - Use descriptive URL names
   - Use `app_name` for namespacing
   - Group related URLs using `include()`
   - Use path converters (`<int:pk>`, `<slug:slug>`)

5. **Forms**:
   - Use ModelForms when possible
   - Add proper validation
   - Use crispy-forms with tailwind for styling
   - Handle form errors gracefully

### HTMX Integration

This project uses HTMX for dynamic interactions without full page reloads:

- Use `hx-get`, `hx-post` for AJAX requests
- Use `hx-target` to specify where to swap content
- Use `hx-swap` to control how content is swapped
- Use `hx-trigger` for custom event triggers
- Return partial templates from HTMX views
- Use `django-htmx` package utilities

Example:
```html
<button hx-post="/like/{{ post.id }}/"
        hx-target="#like-count-{{ post.id }}"
        hx-swap="innerHTML">
    Like
</button>
```

### Database Management

- **Development**: Use SQLite (default, no setup required)
- **Production**: Use PostgreSQL
- **Migrations**: Always create migrations after model changes
- **Never commit migration files** without testing them first
- **Use database transactions** for data integrity
- **Create database indexes** for performance

### Testing

- Write tests in `tests.py` within each app
- Use Django's TestCase for database tests
- Use SimpleTestCase for non-database tests
- Test models, views, forms, and templates
- Run tests before committing: `python manage.py test`
- Aim for meaningful test coverage, not 100% coverage

### Security Best Practices

1. **Never commit secrets**: Use `.env` file for sensitive data
2. **Always use Django's built-in protections**:
   - CSRF tokens in forms
   - XSS protection via template auto-escaping
   - SQL injection protection via ORM
3. **Validate user input** in forms and views
4. **Use `get_object_or_404()`** to prevent information leakage
5. **Check permissions** before allowing actions
6. **Keep DEBUG=False** in production
7. **Use HTTPS** in production (set `SECURE_SSL_REDIRECT=True`)

### Code Style

- Follow **PEP 8** for Python code
- Use **Black** for code formatting (if available)
- Use **meaningful variable names**
- Add **docstrings** to functions and classes
- Keep functions **small and focused**
- Use **type hints** where appropriate
- **Comment complex logic**, not obvious code

## Environment Variables

Required environment variables (in `.env` file):

```
SECRET_KEY=your-secret-key-here
DEBUG=True
DATABASE_URL=sqlite:///db.sqlite3  # or PostgreSQL URL for production
ALLOWED_HOSTS=localhost,127.0.0.1
```

## Static Files

- **Development**: Django serves static files automatically
- **Production**: Use WhiteNoise (already configured)
- **CSS**: Use Tailwind CSS via CDN (no build step needed)
- **JavaScript**: Minimal JS, primarily HTMX and Alpine.js
- **Images**: Store in `static/images/` or use media files

## When Making Changes

### Before You Start

1. Check current git branch (should be on a `claude/` branch)
2. Pull latest changes if working on existing branch
3. Ensure dependencies are installed with `uv pip install -r requirements.txt`
4. Run migrations: `python manage.py migrate`
5. Check if test server runs: `python manage.py runserver`

### During Development

1. **Create migrations** after model changes: `python manage.py makemigrations`
2. **Apply migrations**: `python manage.py migrate`
3. **Test changes** manually in browser
4. **Run automated tests**: `python manage.py test`
5. **Check for errors** in console and browser

### After Implementation

1. **Test thoroughly** - run the development server and verify changes
2. **Run migrations** if you modified models
3. **Update documentation** if adding new features
4. **Commit with clear messages** describing what and why
5. **Push to the designated branch** (not main/master)

## Common Tasks

### Adding a New Django App

```bash
# Create new app
python manage.py startapp <app_name>

# Add to INSTALLED_APPS in config/settings.py
# Create models, views, templates
# Add URLs to config/urls.py
# Create migrations
python manage.py makemigrations
python manage.py migrate
```

### Creating Database Models

```python
from django.db import models

class Example(models.Model):
    title = models.CharField(max_length=200)
    description = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        ordering = ['-created_at']
        verbose_name_plural = "Examples"

    def __str__(self):
        return self.title
```

### Creating Views with HTMX

```python
from django.shortcuts import render, get_object_or_404
from django.http import HttpResponse

def example_view(request):
    # Regular view
    context = {'items': Item.objects.all()}
    return render(request, 'app/example.html', context)

def htmx_partial_view(request, pk):
    # HTMX partial view
    item = get_object_or_404(Item, pk=pk)
    return render(request, 'app/partials/item.html', {'item': item})
```

## Deployment

### Preparation

1. Set `DEBUG=False` in production
2. Configure `ALLOWED_HOSTS`
3. Set up PostgreSQL database
4. Set strong `SECRET_KEY`
5. Run `python manage.py collectstatic`
6. Run migrations: `python manage.py migrate`

### Running in Production

```bash
gunicorn config.wsgi:application --bind 0.0.0.0:8000
```

## Troubleshooting

### Common Issues

1. **Import errors**: Run `uv pip install -r requirements.txt`
2. **Database errors**: Run `python manage.py migrate`
3. **Static files not loading**: Run `python manage.py collectstatic`
4. **Template not found**: Check template directory structure
5. **CSRF errors**: Ensure `{% csrf_token %}` in forms

## Key Reminders

- ✅ **ALWAYS use `uv` for package management**
- ✅ **Server-side rendering is critical for SEO** - don't suggest React/SPA
- ✅ **HTMX for dynamic interactions** - minimal JavaScript
- ✅ **Test before committing** - run server and verify changes
- ✅ **Security first** - validate input, use CSRF tokens, check permissions
- ✅ **Mobile-friendly** - ensure responsive design with Tailwind
- ✅ **Keep it simple** - Django's built-in features are preferred over external libraries

## Resources

- Django Documentation: https://docs.djangoproject.com/
- HTMX Documentation: https://htmx.org/docs/
- Tailwind CSS: https://tailwindcss.com/docs
- uv Documentation: https://github.com/astral-sh/uv

---

**Remember**: This platform aims to serve Pakistani engineers with fast, SEO-friendly content. Prioritize server-side rendering, performance, and accessibility in all implementations.
